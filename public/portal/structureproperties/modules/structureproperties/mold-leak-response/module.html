<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mold & Leak Response • Structure Properties</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:radial-gradient(circle at top left,#0f172a,#020617);color:#e5e7eb;padding:24px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    header img{height:36px;width:auto;display:block}
    .wrap{display:grid;gap:14px}
    .panel{border:1px solid rgba(255,255,255,0.10);border-radius:16px;background:rgba(0,0,0,0.18);overflow:hidden}
    .video{padding:16px}
    video{width:100%;max-height:60vh;background:#020617;border-radius:12px;border:1px solid rgba(255,255,255,0.08)}
    .hint{margin-top:10px;color:#94a3b8;font-size:12px;line-height:1.5}
    .quiz iframe{width:100%;height:55vh;border:0;background:#020617}
    .top-actions{margin-left:auto;display:flex;gap:10px;align-items:center}
    .btn{border:1px solid rgba(255,255,255,0.14);background:rgba(0,0,0,0.22);color:#e5e7eb;
         padding:8px 12px;border-radius:12px;font-weight:900;font-size:12px;cursor:pointer}
    .btn.primary{border-color:rgba(110,231,183,0.35);background:rgba(110,231,183,0.14)}
    a{color:#a7b4d6;text-decoration:none;font-weight:900}
  </style>
</head>
<body>
  <header>
    <img src="../../../../structureproperties-logo.svg" alt="Structure Properties" />
    <div>
      <div style="font-weight:950;">Mold & Leak Response</div>
      <div style="font-size:12px;color:#94a3b8;margin-top:2px;">Static demo • local completion tracking</div>
    </div>
    <div class="top-actions">
      <button class="btn" id="startBtn">Start / Resume</button>
      <button class="btn primary" id="completeBtn">Mark Completed</button>
      <a href="../../../../index.html">← Back</a>
    </div>
  </header>

  <div class="wrap">
    <div class="panel video">
      <video id="vid" controls preload="metadata" poster="./thumb.png">
        <source src="./video.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>
      <div class="hint" id="videoHint">
        If the video doesn't load, drop a <b>video.mp4</b> into:<br/>
        <code>modules/structureproperties/mold-leak-response/video.mp4</code>
      </div>
    </div>

    <div class="panel quiz">
      <iframe src="./quiz.html"></iframe>
    </div>
  </div>

<script>
  const MODULE_ID = "mold-leak-response";
  const kStarted = "qs_started_" + MODULE_ID;
  const kCompleted = "qs_completed_" + MODULE_ID;

  const startBtn = document.getElementById("startBtn");
  const completeBtn = document.getElementById("completeBtn");
  const vid = document.getElementById("vid");
  const videoHint = document.getElementById("videoHint");

  function markStarted() {
    if (!localStorage.getItem(kStarted)) {
      localStorage.setItem(kStarted, new Date().toISOString());
    }
  }

  function markCompleted() {
    localStorage.setItem(kCompleted, new Date().toISOString());
    // Optionally set a simple flag for the portal
    localStorage.setItem("qs_status_" + MODULE_ID, "completed");
    alert("Marked completed. Go back to portal to see the badge.");
  }

  startBtn.addEventListener("click", () => {
    markStarted();
    // if video exists, start playing
    if (vid) {
      try { vid.play(); } catch(e) {}
    }
    alert("Started. Progress will show as In Progress on the portal.");
  });

  completeBtn.addEventListener("click", () => {
    markStarted();
    markCompleted();
  });

  // Hide hint if video successfully loads metadata
  vid.addEventListener("loadedmetadata", () => {
    videoHint.style.display = "none";
  });

  // If video fails, keep hint visible
  vid.addEventListener("error", () => {
    videoHint.style.display = "block";
  });
</script>
</body>
</html>
