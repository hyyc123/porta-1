<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mold & Leak Response SOP</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    background:#000;
    color:#fff;
    font-family:Arial, sans-serif;
    display:flex;
    flex-direction:column;
}

.title {
    text-align:center;
    padding:12px;
    background:#222;
    font-size:1.6em;
    font-weight:600;
}

.video-container {
    flex:1;
    display:flex;
    flex-direction:column;
}

video {
    width:100%;
    max-height:calc(100vh - 120px);
    background:black;
}

.controls {
    display:flex;
    align-items:center;
    padding:10px;
    background:rgba(0,0,0,0.75);
}

.controls button {
    background:none;
    border:none;
    color:white;
    font-size:1.3em;
    cursor:pointer;
}

.progress-container {
    flex:1;
    height:10px;
    background:#555;
    margin:0 10px;
    border-radius:6px;
    position:relative;
    cursor:pointer;
}

.progress {
    height:100%;
    width:0%;
    background:#4caf50;
    border-radius:6px;
}

.question-marker {
    position:absolute;
    width:5px;
    height:14px;
    top:-2px;
    background:#f44336;
    border-radius:3px;
}

/* ===== QUESTION MODAL ===== */
.question-modal {
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    background:linear-gradient(180deg, #2b2b2b, #1c1c1c);
    padding:30px;
    border-radius:18px;
    width:92%;
    max-width:640px;
    box-shadow:0 20px 60px rgba(0,0,0,0.8);
    z-index:1000;
}

.question-modal h2 {
    font-size:1.8em;
    font-weight:600;
    margin-bottom:25px;
}

.options {
    display:flex;
    flex-direction:column;
    gap:14px;
}

.options button {
    padding:18px;
    font-size:1.2em;
    border-radius:14px;
    border:1px solid #555;
    background:#262626;
    color:white;
    cursor:pointer;
    transition:all 0.2s ease;
}

.options button:hover {
    background:#333;
}

.options button.correct {
    background:#2e7d32;
    border-color:#2e7d32;
}

.options button.incorrect {
    background:#c62828;
    border-color:#c62828;
}

.modal-actions {
    display:flex;
    justify-content:space-between;
    margin-top:25px;
}

.modal-actions button {
    padding:12px 24px;
    font-size:1.1em;
    border:none;
    border-radius:12px;
    cursor:pointer;
}

#nextBtn {
    background:#4caf50;
    color:white;
    display:none;
}

#backBtn {
    background:#2196f3;
    color:white;
    display:none;
}
</style>
</head>

<body>

<div class="title">Mold & Leak Response SOP</div>

<div class="video-container">
    <video id="video" preload="metadata">
        <source src="Copy of Mold and Leak.mp4" type="video/mp4">
    </video>

    <div class="controls">
        <button id="playBtn"><i class="fas fa-play"></i></button>
        <div class="progress-container" id="progressContainer">
            <div class="progress" id="progress"></div>
        </div>
        <input type="range" min="0" max="1" step="0.01" value="1" id="volume">
    </div>
</div>

<div class="question-modal" id="modal">
    <h2 id="qText"></h2>
    <div class="options" id="options"></div>
    <div class="modal-actions">
        <button id="backBtn">Go Back</button>
        <button id="nextBtn">Continue</button>
    </div>
</div>

<script>
const video = document.getElementById('video');
const playBtn = document.getElementById('playBtn');
const progress = document.getElementById('progress');
const progressContainer = document.getElementById('progressContainer');
const volume = document.getElementById('volume');

const modal = document.getElementById('modal');
const qText = document.getElementById('qText');
const options = document.getElementById('options');
const nextBtn = document.getElementById('nextBtn');
const backBtn = document.getElementById('backBtn');

/**
 * Mold & Leak Response SOP â€” VTT-aligned checkpoints (seconds)
 * Times: 00:00:28, 00:00:44, 00:00:59, 00:01:13, 00:01:26, 00:01:36,
 *        00:01:55, 00:02:06, 00:02:24, 00:02:42, 00:02:50, 00:03:23
 */
const questions = [
    {
        time: 28,
        question: "What three conditions are required for mold to grow?",
        options: [
            {text:"Darkness, dust, and time", correct:false},
            {text:"Moisture, warmth, and organic material", correct:true},
            {text:"Water pressure, heat, and airflow", correct:false},
            {text:"Poor housekeeping only", correct:false}
        ],
        answered:false
    },
    {
        time: 44,
        question: "Under California law, who bears the ultimate responsibility for habitability issues like mold?",
        options: [
            {text:"The tenant", correct:false},
            {text:"The Resident Manager", correct:false},
            {text:"The landlord/property owner", correct:true},
            {text:"The city", correct:false}
        ],
        answered:false
    },
    {
        time: 59,
        question: "What is the primary goal when responding to water intrusion or mold?",
        options: [
            {text:"Determine tenant fault", correct:false},
            {text:"Stop the source, limit damage, and prevent future risk", correct:true},
            {text:"Schedule repairs for later review", correct:false},
            {text:"Document only", correct:false}
        ],
        answered:false
    },
    {
        time: 73,
        question: "What is the first decision that must be made when evaluating a leak?",
        options: [
            {text:"Whether insurance will cover it", correct:false},
            {text:"Whether the leak is minor or major", correct:true},
            {text:"Which vendor is cheapest", correct:false},
            {text:"Whether mold is visible", correct:false}
        ],
        answered:false
    },
    {
        time: 86,
        question: "Why do porous materials increase mold risk?",
        options: [
            {text:"They trap odors", correct:false},
            {text:"They cannot be dried", correct:false},
            {text:"They retain moisture beyond 48 hours", correct:true},
            {text:"They attract pests", correct:false}
        ],
        answered:false
    },
    {
        time: 96,
        question: "Which type of water requires professional mitigation?",
        options: [
            {text:"Clean drinking water", correct:false},
            {text:"Condensation", correct:false},
            {text:"Gray or black water", correct:true},
            {text:"Rainwater only", correct:false}
        ],
        answered:false
    },
    {
        time: 115,
        question: "After how long does professional mitigation become mandatory?",
        options: [
            {text:"Immediately", correct:false},
            {text:"After 24 hours", correct:false},
            {text:"Beyond 48 hours", correct:true},
            {text:"Only if mold is visible", correct:false}
        ],
        answered:false
    },
    {
        time: 126,
        question: "For plumbing leaks, what is the correct initial response?",
        options: [
            {text:"Schedule environmental testing first", correct:false},
            {text:"Stop the water and contain the damage", correct:true},
            {text:"Begin interior repairs immediately", correct:false},
            {text:"Notify tenants only", correct:false}
        ],
        answered:false
    },
    {
        time: 144,
        question: "What environmental hazards may require testing after a leak is contained?",
        options: [
            {text:"Mold only", correct:false},
            {text:"Lead and asbestos only", correct:false},
            {text:"Lead, asbestos, and mold", correct:true},
            {text:"Carbon monoxide", correct:false}
        ],
        answered:false
    },
    {
        time: 162,
        question: "If a unit becomes uninhabitable due to a leak, what may be required?",
        options: [
            {text:"Lease termination", correct:false},
            {text:"Temporary tenant relocation with potential daily costs owed", correct:true},
            {text:"Rent freeze only", correct:false},
            {text:"No action", correct:false}
        ],
        answered:false
    },
    {
        time: 170,
        question: "When mold results from tenant behavior, what is the correct response?",
        options: [
            {text:"Ignore the issue", correct:false},
            {text:"Immediately begin mitigation", correct:false},
            {text:"Reference the Mold Addendum and instruct on cleaning and ventilation", correct:true},
            {text:"Evict the tenant", correct:false}
        ],
        answered:false
    },
    {
        time: 203,
        question: "When unsure how to proceed with mold or water intrusion, what should you do?",
        options: [
            {text:"Make a judgment call", correct:false},
            {text:"Wait for owner direction", correct:false},
            {text:"Document and escalate", correct:true},
            {text:"Close the request", correct:false}
        ],
        answered:false
    }
];

let checkpoints = [0];
let markers = [];

/* ===== CONTROLS ===== */
playBtn.onclick = () => video.paused ? video.play() : video.pause();
video.onplay = () => playBtn.innerHTML='<i class="fas fa-pause"></i>';
video.onpause = () => playBtn.innerHTML='<i class="fas fa-play"></i>';
volume.oninput = () => video.volume = volume.value;

/* ===== MARKERS ===== */
video.onloadedmetadata = () => {
    questions.forEach((q,i) => {
        const m = document.createElement('div');
        m.className = 'question-marker';
        m.style.left = `${(q.time / video.duration) * 100}%`;
        progressContainer.appendChild(m);
        markers.push(m);
    });
};

/* ===== SKIP LOGIC ===== */
function maxAllowedTime() {
    const next = questions.find(q => !q.answered);
    return next ? next.time - 0.05 : video.duration;
}

progressContainer.onclick = e => {
    const t = (e.offsetX / progressContainer.clientWidth) * video.duration;
    video.currentTime = Math.min(t, maxAllowedTime());
};

/* ===== QUESTIONS ===== */
function checkQuestions() {
    const next = questions.find(q => !q.answered);
    if (next && video.currentTime >= next.time) {
        video.pause();
        showQuestion(next);
    }
}

function showQuestion(q) {
    if (q.answered) return;

    qText.textContent = q.question;
    options.innerHTML = '';
    nextBtn.style.display = 'none';
    backBtn.style.display = 'inline';

    q.options.forEach(opt => {
        const b = document.createElement('button');
        b.textContent = opt.text;

        b.onclick = () => {
            options.querySelectorAll('button').forEach(x => x.disabled = true);

            if (opt.correct) {
                b.classList.add('correct');
                q.answered = true;
                checkpoints.push(video.currentTime + 0.2);
                markers[questions.indexOf(q)].style.background = '#4caf50';
                nextBtn.style.display = 'inline';
            } else {
                b.classList.add('incorrect');
            }
        };
        options.appendChild(b);
    });

    modal.style.display = 'block';
}

video.ontimeupdate = () => {
    progress.style.width = (video.currentTime / video.duration) * 100 + '%';
    checkQuestions();
};

/* ===== MODAL NAV ===== */
nextBtn.onclick = () => {
    modal.style.display = 'none';
    video.play();
};

backBtn.onclick = () => {
    const target = checkpoints[checkpoints.length - 1];
    modal.style.display = 'none';
    video.currentTime = target;
    video.play();
};
</script>

</body>
</html>
