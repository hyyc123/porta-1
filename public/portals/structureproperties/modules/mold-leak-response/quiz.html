<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mold & Leak Response – Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body { margin: 0; padding: 20px; background: #020617; color: #e5e7eb; font-family: system-ui, -apple-system, Segoe UI, Roboto; }
  h2 { margin-top: 0; font-weight: 900; }
  .question { margin-bottom: 20px; padding: 16px; border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; background: rgba(255,255,255,0.04); }
  .answers { margin-top: 10px; display: grid; gap: 8px; }
  button.option { padding: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.25); color: #e5e7eb; font-weight: 700; cursor: pointer; text-align: left; }
  button.option:hover { background: rgba(255,255,255,0.08); }
  button.option.correct { border-color: #22c55e; background: rgba(34,197,94,0.2); }
  button.option.wrong { border-color: #ef4444; background: rgba(239,68,68,0.2); }
  #submit { margin-top: 20px; padding: 14px; width: 100%; border-radius: 14px; border: 1px solid rgba(110,231,183,0.35);
    background: linear-gradient(180deg, rgba(110,231,183,0.25), rgba(110,231,183,0.12)); font-weight: 900; color: #e5e7eb; cursor: pointer; font-size: 15px; }
  #result { margin-top: 16px; font-weight: 900; line-height: 1.4; }
  .small { font-size: 12px; color: #a7b4d6; margin-top: 6px; }
</style>
</head>

<body>

<h2>Mold & Leak Response Quiz</h2>
<div class="small">Answer all questions, then submit to complete.</div>

<div class="question" data-correct="1">
  <div><b>1.</b> What is the FIRST action when a mold or leak issue is reported?</div>
  <div class="answers">
    <button class="option">Ignore it until maintenance hours</button>
    <button class="option">Assess the situation and stop the source if possible</button>
    <button class="option">Call the resident back next week</button>
  </div>
</div>

<div class="question" data-correct="0">
  <div><b>2.</b> Why is mold considered a serious issue?</div>
  <div class="answers">
    <button class="option">It can cause health risks and property damage</button>
    <button class="option">It only smells bad</button>
    <button class="option">It is cosmetic only</button>
  </div>
</div>

<div class="question" data-correct="2">
  <div><b>3.</b> Who should be notified for significant leaks or mold?</div>
  <div class="answers">
    <button class="option">Only the resident</button>
    <button class="option">No one</button>
    <button class="option">Property Manager or appropriate leadership</button>
  </div>
</div>

<button id="submit">Submit Quiz</button>
<div id="result"></div>

<script>
  const questions = document.querySelectorAll(".question");
  let wrongAnswers = 0;
  let attempts = 0;

  // Track selecting answers (one attempt per question)
  questions.forEach(q => {
    const correctIndex = Number(q.dataset.correct);
    const options = q.querySelectorAll(".option");

    options.forEach((btn, idx) => {
      btn.addEventListener("click", () => {
        if (q.dataset.answered === "true") return;

        q.dataset.answered = "true";
        attempts++;

        if (idx === correctIndex) {
          btn.classList.add("correct");
        } else {
          btn.classList.add("wrong");
          options[correctIndex].classList.add("correct");
          wrongAnswers++;
        }

        // disable all buttons in this question
        options.forEach(o => o.disabled = true);
      });
    });
  });

  document.getElementById("submit").addEventListener("click", () => {
    // ensure all questions answered
    const answeredCount = Array.from(questions).filter(q => q.dataset.answered === "true").length;
    if (answeredCount !== questions.length) {
      alert("Please answer all questions before submitting.");
      return;
    }

    const passed = true; // for now, always pass once submitted
    const totalQuestions = questions.length;

    document.getElementById("result").innerText =
      wrongAnswers === 0
        ? "✅ Perfect score!"
        : `✅ Completed with ${wrongAnswers} wrong answer(s).`;

    // Notify parent (module.html) that quiz completed
    parent.postMessage(
      {
        type: "qs_quiz_completed",
        passed,
        wrongAnswers,
        totalQuestions,
        attempts,
        completedAt: new Date().toISOString()
      },
      "*"
    );
  });
</script>

</body>
</html>
